/* ------------------------- PINNED EXTENSIONS ------------------------- */

@media (-moz-pref('nug-pinned-extensions-mod')) {
	/* Zen 1.12.6b Fix */
	:root[customizing] #TabsToolbar-customization-target {
		visibility: visible !important;
	}

	.zen-workspace-pinned-tabs-section {
		display: flex !important;
		flex-direction: column;
	}

	:root[zen-single-toolbar='true'] #nav-bar {
		margin-bottom: 8px !important; /* Adjust gap between urlbar and extensions */
	}

	/* Pinned extensions */
	#TabsToolbar-customization-target {
		display: flex !important;
		flex-direction: row !important;
		flex-wrap: wrap !important;
		gap: calc(var(--zen-toolbox-padding) - 3px) !important;

		#tabbrowser-tabs {
			min-width: 100% !important;
			height: calc(100% - 37px) !important;
		}

		#Zen-tabs-wrapper {
			max-height: 700px !important;
		}

		.unified-extensions-item-action-button {
			padding: 0px !important;
		}

		/* Pinned Extensions */
		.unified-extensions-item {
			margin-inline: 2px !important;
			border-bottom: 0px !important;
			padding: 0px !important;
			height: 32px !important;
			width: 32px !important;
			flex-grow: 1 !important;
			order: -1 !important;
			background-color: var(--nug-color-bg) !important;
			box-shadow: 0 0px 3px light-dark(rgba(255, 255, 255, 0), rgba(0, 0, 0, 0)) !important;
			border-radius: calc(var(--nug-border-radius) - 0.5px) !important;
			transition: background-color 0.3s ease, box-shadow 0.3s ease !important;
		}

		.unified-extensions-item:hover {
			background-color: var(--nug-color-hover) !important;
			box-shadow: 0 0px 3px light-dark(rgba(255, 255, 255, 0.5), rgba(0, 0, 0, 0.95)) !important;
		}

		> toolbarbutton:not([id='tabs-newtab-button']):not(#sort-button):not(#clear-button),
		> toolbaritem:not(#sort-button):not(#clear-button) {
			height: 32px !important;
			width: 32px !important;
			flex-grow: 1 !important;
			padding: 0px !important;

			toolbarbutton,
			stack {
				--toolbarbutton-active-background: transparent !important;
				--toolbarbutton-hover-background: transparent !important;
			}

			.toolbarbutton-badge {
				display: none !important;
			}

			.toolbarbutton-text {
				display: none !important;
			}
		}

		> toolbarbutton:not([id='tabs-newtab-button']),
		> toolbaritem {
			background-color: var(--nug-color-bg) !important;
			box-shadow: 0 0px 3px light-dark(rgba(255, 255, 255, 0.12), rgba(0, 0, 0, 0.12)) !important;
			border-radius: calc(var(--nug-border-radius) + 1px) !important;
			margin: 0px !important;
			order: -1 !important;
			flex-grow: 1 !important;
			transition: background-color 0.3s ease, box-shadow 0.3s ease !important;
		}

		> toolbarbutton:not([id='tabs-newtab-button']):hover,
		> toolbaritem:hover {
			background-color: var(--nug-color-hover) !important;
			box-shadow: 0 0px 3px light-dark(rgba(255, 255, 255, 0.95), rgba(0, 0, 0, 0.95)) !important;
		}
	}

	/* for collapsed toolbar */
	html:not([zen-sidebar-expanded='true']):not([zen-single-toolbar='true'])
		#TabsToolbar-customization-target
		.unified-extensions-item {
		width: 24px !important;
		height: 32px !important;
		margin-inline: 6px !important; /* fake side padding */
		margin-block: 2px !important; /* vertical spacing */
	}

	/* -------- Hover animation gradient (matching tab style) -------- */
	.unified-extensions-item {
		position: relative !important;
		border-radius: calc(var(--nug-border-radius) + 1px) !important;
	}

	.unified-extensions-item::before {
		content: '';
		position: absolute;
		inset: -0.1px; /* Shrinks the effect area like tab style */
		background: linear-gradient(
			45deg,
			color-mix(in srgb, var(--zen-primary-color) 5%, black),
			color-mix(in srgb, var(--zen-primary-color) 30%, black),
			color-mix(in srgb, var(--zen-primary-color) 75%, black),
			color-mix(in srgb, var(--zen-primary-color) 100%, black),
			color-mix(in srgb, var(--zen-primary-color) 50%, black),
			color-mix(in srgb, var(--zen-primary-color) 15%, black)
		);
		background-size: 200% 200%;
		border-radius: calc(var(--nug-border-radius) - 2px) !important;
		clip-path: inset(0 round calc(var(--nug-border-radius) - 2px));
		animation: tab-hover-gradient 3.5s linear infinite;
		animation-play-state: paused;
		opacity: 0;
		filter: blur(10px) brightness(0.6) contrast(120%);
		transition: opacity 0.4s ease-in-out;
		pointer-events: none;
		z-index: 0;
	}

	/* Glow on hover */
	.unified-extensions-item:hover::before {
		animation-play-state: running;
		opacity: 0.5;
	}

	/* Hide glow when hovering close/reset - uses JS polyfill for Wayland compatibility */
	.unified-extensions-item.nug-child-hovered::before {
		opacity: 0;
	}

	/* Style 0 - No gradient */
	@media (-moz-pref('nug-glow-gradient', 0)) {
		.unified-extensions-item::before {
			display: none;
		}
	}

	/* Style 2 - Monochrome gradient (light-dark) */
	@media (-moz-pref('nug-glow-gradient', 2)) {
		.unified-extensions-item::before {
			background: linear-gradient(
				45deg,
				light-dark(#dddddd, #ffffff),
				light-dark(#eeeeee, #dddddd),
				light-dark(#dddddd, #bbbbbb),
				light-dark(#ffffff, #000000),
				light-dark(#eeeeee, #dddddd),
				light-dark(#dddddd, #ffffff)
			);
			background-size: 200% 200%;
			animation: tab-hover-gradient 3.5s linear infinite;
			animation-play-state: paused;
		}
	}

	/* Style 3 - RGB gradient */
	@media (-moz-pref('nug-glow-gradient', 3)) {
		.unified-extensions-item::before {
			background: linear-gradient(45deg, #ff8a00, #e52e71, #7f00ff, #00c9ff, #ff8a00);
			background-size: 200% 200%;
			animation: tab-hover-gradient 3.5s linear infinite;
			animation-play-state: paused;
		}
	}

	/* Gradient animation (same as tabs) */
	@keyframes tab-hover-gradient {
		from {
			background-position: 0% 50%;
		}
		to {
			background-position: 200% 50%;
		}
	}
}

/* ------------------------- Unified Extension Menu ------------------------- */
/* Extension Grid Styling */
@media (-moz-bool-pref: 'mod.extension.viewgrid') {
	#unified-extensions-view {
		width: calc(var(--menu-panel-width) - 30px) !important;
	}

	/* Hide header/description/texts and settings icon for each extension */
	#unified-extensions-description,
	#unified-extensions-view .panel-header,
	#unified-extensions-view > :nth-child(2),
	.unified-extensions-item-name,
	.unified-extensions-item-message,
	.unified-extensions-item-message-hover,
	.unified-extensions-item-message-hover-menu-button,
	.unified-extensions-item-menu-button {
		display: none !important;
	}

	/* Arrange extensions in a centered grid */
	#unified-extensions-view #overflowed-extensions-list,
	#unified-extensions-view #unified-extensions-area,
	#unified-extensions-view .unified-extensions-list {
		display: grid !important;
		grid-template-columns: repeat(4, 1fr) !important;
		justify-content: left !important;
		align-items: center !important;
		margin-inline: 4px !important;
		width: 0px !important;
		gap: 8px !important; /* Add space between icons */
	}

	#unified-extensions-view #unified-extensions-area {
		padding-block-end: 10px !important;
	}

	/* Center buttons and tidy margins */
	#unified-extensions-view .unified-extensions-item {
		display: flex !important;
		align-items: center !important;
		justify-content: center !important;
		border-radius: 12px !important;
	}

	#unified-extensions-view .unified-extensions-item-icon,
	#unified-extensions-view
		.unified-extensions-item
		.webextension-browser-action.subviewbutton
		> .toolbarbutton-badge-stack {
		margin: 0px !important;
	}

	/* Properly center and size extension icons */
	#unified-extensions-view .unified-extensions-item-action-button {
		display: flex !important;
		align-items: center !important;
		justify-content: center !important;
	}

	#unified-extensions-view .unified-extensions-item-icon {
		width: 20px !important;
		height: 20px !important;
		margin: 0 !important;
	}

	#unified-extensions-view .webextension-browser-action .toolbarbutton-icon {
		width: 20px !important;
		height: 20px !important;
		margin: 0 !important;
	}

	#unified-extensions-view panelview .unified-extensions-item-action-button {
		padding: 12px 12px !important;
		display: flex !important;
		align-items: center !important;
		justify-content: center !important;
	}

	#unified-extensions-view toolbarseparator {
		margin-top: 0px !important;
	}

	/* Hide the Manage Extensions footer button */
	#unified-extensions-manage-extensions {
		display: none !important;
	}
}

#unified-extras-button {
	margin-left: 132px;
}

/* Panel Positioning Styles */
#unified-extensions-panel {
	margin-left: -106px !important;
}

#unified-extensions-panel[position='bottomright topright'] {
	position: fixed !important;
	left: 50% !important;
	transform: translateX(-50%) !important;
}

@media (-moz-bool-pref: 'mod.extension.viewgrid') {
	#unified-extensions-view toolbarseparator {
		margin-top: 0px !important;
	}
}

panel toolbarseparator {
	margin: 0 !important;
}

#unified-extensions-messages-container {
	margin: 0 !important;
}

#unified-extensions-view .unified-extensions-item-icon,
#unified-extensions-view
	.unified-extensions-item
	.webextension-browser-action.subviewbutton
	> .toolbarbutton-badge-stack
	> .toolbarbutton-icon {
	margin-left: 0px !important;
}

.subviewbutton-iconic {
	& > .toolbarbutton-icon {
		margin-left: 0px !important;
	}
}

#unified-extensions-view #unified-extensions-area {
	.unified-extensions-item-action-button {
		background-color: color-mix(in srgb, currentcolor 6%, transparent) !important;
		width: 48px !important;
		height: 48px !important;
		display: flex !important;
		align-items: center !important;
		justify-content: center !important;
		padding: 12px !important;
	}
}

#unified-extensions-view #unified-extensions-area {
	.unified-extensions-item-action-button:hover {
		background-color: color-mix(in srgb, currentcolor 10%, transparent) !important;
		cursor: pointer !important;
	}
}

#unified-extensions-view {
	backdrop-filter: blur(10px) !important;
	background: rgba(0, 0, 0, 0.1) !important;
}

:is(panelview, #widget-overflow-fixed-list) .toolbaritem-combined-buttons {
	margin: 4.8px !important;
}

:is(
		panelview .toolbarbutton-1,
		toolbarbutton.subviewbutton,
		.widget-overflow-list .toolbarbutton-1,
		.toolbaritem-combined-buttons:is(:not([cui-areatype='toolbar']), [overflowedItem='true']) > toolbarbutton
	) {
	&:not([disabled]):hover {
		background-color: color-mix(in srgb, currentcolor 10%, transparent) !important;
		cursor: pointer !important;
	}
}

#unified-extensions-view #unified-extensions-panel .unified-extensions-item {
	margin-block: 4.8px !important;
}
