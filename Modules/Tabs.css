@keyframes half-borderTrail {
	0% {
		top: 10%;
		left: 20%;
		width: 20%;
		height: 3px;
		opacity: 1;
	}
	15% {
		top: 10%;
		left: 60%;
		width: 20%;
		height: 3px;
		opacity: 0.8;
	}
	25% {
		top: 10%;
		left: 95.5%;
		width: 3px;
		height: 3px;
		opacity: 0.6;
	}
	45% {
		top: 50%;
		left: 95.5%;
		width: 3px;
		height: 30%;
		opacity: 0.7;
	}
	55% {
		top: 76%;
		left: 95.5%;
		width: 3px;
		height: 3px;
		opacity: 0.9;
	}
	75% {
		top: 76%;
		left: 85%;
		width: 10%;
		height: 3px;
		opacity: 1;
	}
	100% {
		top: 76%;
		left: 70%;
		width: 20%;
		height: 3px;
		opacity: 0;
	}
}

/* tweaks */
/* hide tab audio button */
.tab-audio-button {
	display: none !important;
}

/* make glance buttons dark */
.zen-glance-sidebar-container toolbarbutton {
	background: var(--surface0) !important;
}

/* move glances back to the left */
.zen-glance-sidebar-container {
	right: 100% !important;
	left: unset !important;
}

/* .zen-glance-sidebar-container toolbarbutton:hover {
	border: .1px solid var(--nug-accent) !important;
} */

/* hide clear all unpinned tabs + seperator */
.pinned-tabs-container-separator,
.zen-workspace-close-unpinned-tabs-button {
	display: none !important;
}

/* essentials */
.zen-essentials-container .tabbrowser-tab {
	.tab-background {
		background: var(--base) !important;
		border-radius: 5px !important;
		backdrop-filter: blur(10px) !important;
	}

	&:hover .tab-background {
		background: var(--surface0) !important;
	}

	&[selected]:hover .tab-background {
		background: var(--base) !important;
		/* 		border: 1px solid var(--nug-accent-off) !important; */
	}

	&[visuallyselected] .tab-background {
		border: 1px solid var(--nug-glow-color-1) !important;
	}
}

/* tabs */
.tabbrowser-tab:not([zen-essential]) {
	& .tab-background {
		border-radius: 4px !important;
		/* 		background: none !important; */
	}

	/*   &[selected]:hover .tab-background, */
	:not([selected]):hover .tab-background {
		background: var(--base) !important;
		border: 1px solid var(--overlay1) !important;
	}

	&[selected='true'] .tab-background,
	&[selected='true']:hover .tab-background {
		background: var(--base) !important;
		border: 1px solid var(--nug-glow-color-2) !important;
	}

	&[multiselected='true'] .tab-background {
		background: var(--base) !important;
		border: 1px solid var(--nug-accent-off) !important;
	}
}

/* new tab button */
:root[zen-sidebar-expanded='true'] {
	#tabs-newtab-button {
		background: var(--mantle) !important;
		border-radius: 8px !important;
		margin: 10px 1px !important;
		justify-content: center !important;

		& .toolbarbutton-text {
			padding: 0px 10px 0px 10px !important;
			color: var(--subtext0) !important;
			font-family: monospace !important;
			font-size: 14px !important;
		}

		& .toolbarbutton-text::before {
			justify-self: center !important;
			align-self: center !important;
			display: flex !important;
			left: auto !important;
			right: auto !important;
			transition: margin-left 0.3s !important;
		}

		& .toolbarbutton-icon {
			transition: scale 0.3s ease !important;
		}
	}

	#tabs-newtab-button:hover {
		opacity: 1 !important;
		/* box-shadow: 0px 0px 3px var(--mauve) !important; */

		& .toolbarbutton-text::before {
			margin-left: 8px !important;
		}

		& .toolbarbutton-icon {
			scale: 1.2 !important;
		}
	}
}

:root:not([zen-sidebar-expanded='true']) {
	#tabs-newtab-button {
		margin: 10px auto !important;
		justify-self: center !important;
		background: var(--mantle) !important;
		border-radius: 4px !important;
		box-sizing: unset !important;
		width: calc(var(--tab-min-height) - 0.5px) !important;
		min-height: calc(var(--tab-min-height) - 2px) !important;
		max-height: calc(var(--tab-min-height) - 2px) !important;

		& .toolbarbutton-icon {
			background: none !important;
			transition: scale 0.4s ease !important;
		}
	}

	#tabs-newtab-button:hover {
		opacity: 1 !important;
		box-shadow: 0px 0px 3px var(--nug-icon-color) !important;

		& .toolbarbutton-text::before {
			margin-left: 8px !important;
		}

		& .toolbarbutton-icon {
			scale: 1.5 !important;
		}
	}
}

/*  close/reset buttons */
.zen-workspace-normal-tabs-section .tabbrowser-tab .tab-background::before,
.zen-workspace-pinned-tabs-section .tabbrowser-tab .tab-background::before {
	display: flex !important;
	opacity: 0;
	content: '' !important;
	width: 100%;
	height: 100%;
	position: absolute !important;
	border-radius: 10px !important;
	border: 1px solid var(--nug-accent-off) !important;
	background: var(--nug-accent-off) !important;
	box-shadow: 0px 0px 9px var(--nug-accent-off) !important;
	z-index: 3 !important;
}

.tab-close-button,
.tab-reset-button {
	margin-right: 2px !important;
	padding: 3px 3px !important;
	height: 18px !important;
	width: 18px !important;
	border-radius: 20px !important;
}

.tab-close-button:hover,
.tab-reset-button:hover {
	background: color-mix(in srgb, var(--overlay1) 20%, transparent) !important;
}

:root:not([zen-sidebar-expanded='true']) {
	.tab-close-button,
	.tab-reset-button {
		left: -2px !important;
		right: auto !important;
		padding: 3px 3px !important;
		height: 18px !important;
		width: 18px !important;
		border-radius: 20px !important;
	}
}

.tabbrowser-tab.nug-child-hovered .tab-background::before {
	animation: half-borderTrail 3s infinite cubic-bezier(0.7, 0, 0.3, 1) forwards !important;
	clip-path: inset(0 0 0 0);
}

/* pinned */
@media (-moz-pref('uc.pins.legacy-layout')) {
	#navigator-toolbox[zen-sidebar-expanded='true'] {
		& #tabbrowser-tabs {
			& .tabbrowser-tab {
				&[zen-pinned-changed='true']:not([zen-essential]) > .tab-stack > .tab-content > .tab-icon-stack {
					position: unset !important;
					top: unset !important;
				}
			}
		}
	}

	#vertical-pinned-tabs-container,
	.zen-workspace-pinned-tabs-section:not(
			:has([zen-dragtarget], zen-folder .tab-group-label-container[zen-dragtarget])
		) {
		.tabbrowser-tab[pinned]:not(zen-folder .tabbrowser-tab) {
			.tab-close-button,
			.tab-reset-button,
			.tab-reset-pin-button,
			.tab-label-container {
				display: none !important;
			}
		}
	}

	/* Disable icon shift when tab was renamed */
	#navigator-toolbox[zen-sidebar-expanded='true'] {
		& #vertical-pinned-tabs-container > .zen-workspace-tabs-section,
		& .zen-workspace-pinned-tabs-section {
			& .tabbrowser-tab:not(zen-folder .tabbrowser-tab) > .tab-stack > .tab-content > .tab-icon-stack {
				left: unset !important;
			}
		}
	}

	/* The actual grid layout */
	#vertical-pinned-tabs-container > .zen-workspace-tabs-section,
	.zen-workspace-pinned-tabs-section:not(
			:has([zen-dragtarget], zen-folder .tab-group-label-container[zen-dragtarget])
		) {
		display: grid !important;
		grid-template-columns: repeat(auto-fit, minmax(var(--tab-pinned-min-width-expanded), auto)) !important;
		grid-auto-flow: dense !important;

		&:has(> :nth-child(2)) {
			margin: 0 var(--zen-toolbox-padding) !important;
			padding: 0 var(--zen-toolbox-padding) !important;
			overflow: visible !important;
			padding-bottom: 17px !important;
			gap: 3px 3px !important;
			max-width: calc(100% - var(--zen-toolbox-padding) * 2) !important;
		}

		.tabbrowser-tab:not(zen-folder .tabbrowser-tab) {
			--toolbarbutton-inner-padding: 0;
		}

		& > *:not(tab-group):not(zen-folder) {
			margin: 0 !important;
		}

		& > tab-group .tab-icon-stack {
			margin: auto !important;
		}

		/* Folders span full width and create new rows */
		& > zen-folder {
			grid-column: 1 / -1 !important;
		}
	}

	/* Normal layout for folder tabs */
	.zen-workspace-pinned-tabs-section zen-folder > .tab-group-container {
		display: flex !important;
		flex-direction: column !important;
		gap: 2px !important;
		margin: 0 !important;
		padding: 0 0 0 12px !important;
		width: 100% !important;
		box-sizing: border-box !important;

		.tabbrowser-tab {
			min-height: var(--tab-min-height) !important;
			width: 100% !important;
			margin: 0 !important;

			/* Hide reset pin button for folder tabs */
			& .tab-reset-pin-button {
				display: none !important;
			}

			/* Reset pinned tab styles for folder tabs */
			& .tab-stack {
				width: 100% !important;
			}

			/* Ensure proper content layout for folder tabs */
			& .tab-content {
				display: flex !important;
				align-items: center !important;
				width: 100% !important;
				padding-inline: var(--inline-tab-padding) !important;
			}

			& .tab-icon-stack {
				margin-left: 0 !important;
				transform: none !important;
				margin-inline-start: 0 !important;
				position: relative !important;
				left: 0 !important;
				padding-left: 4px !important;
			}

			& .tab-label-container {
				flex: 1 !important;
				display: flex !important;
				padding-right: 4px !important;
			}

			/* Add spacing so border doesn't touch edges */
			& .tab-background {
				margin: 1px 2px !important;
			}
		}
	}
	#vertical-pinned-tabs-container > .zen-workspace-tabs-section {
		align-items: normal;
	}

	.zen-workspace-pinned-tabs-section:not(:has([zen-dragtarget], zen-folder .tab-group-label-container[zen-dragtarget]))
		zen-folder[collapsed]
		.tab-group-container {
		display: none !important;
	}

	.zen-workspace-pinned-tabs-section:not(
			:has([zen-dragtarget], zen-folder .tab-group-label-container[zen-dragtarget])
		) {
		position: relative !important;

		.tabbrowser-tab:not(zen-folder .tabbrowser-tab) .tab-icon-stack {
			margin-left: 50% !important;
			transform: translateX(-50%) !important;
		}
	}

	.vertical-pinned-tabs-container-separator,
	.pinned-tabs-container-separator {
		position: absolute !important;
		bottom: 7px !important;
		left: 50% !important;
		transform: translateX(-50%) !important;
		width: calc(100% - var(--zen-toolbox-padding) * 2) !important;
	}
}

/* folder label container styling */
.tab-group-label-container::before {
	background-color: transparent !important;
	background: none !important;
}

zen-folder {
	& > .tab-group-label-container {
		&::before {
			content: '';
			position: absolute;
			top: 2px;
			left: 1px !important;
			width: calc(100% - 3px) !important;
			height: calc(100% - 4px) !important;
			background-color: transparent;
			border-radius: 12px !important;
			z-index: -1;
		}

		& > label {
			width: 100% !important;

			background: transparent !important;
			border: none !important;
			color: var(--text) !important;
			margin: 0 !important;
			font-weight: calc(var(--tab-font_weight) + 10) !important;
			font-size: calc(var(--tab-font_size) + 0.5px) !important;
			display: flex;
			margin-top: 1px !important;
			margin-left: 2px !important;
			align-items: center;
			height: 100% !important;
			text-align: start;

			:root:not([zen-sidebar-expanded]) & {
				padding: 0 !important;
				max-width: 100% !important;
			}
		}
	}
}
